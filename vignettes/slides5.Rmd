---
title: "Chapter 5: layout"
author: Colin Gillespie
date: "`r Sys.Date()`"
#output: revealjs::revealjs_presentation
output: ioslides_presentation
---
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Chapter 5 Slides}
-->

# Introduction
## Introduction

  * We've have relied on markdown for layout
    * __Trust me__: use `flexdashboard` if you can!
  * When we create a full shiny app, we have to worry about layour
    * __Pro__: Finer control
    * __Con__: Bracket madness!

## Introduction: A shiny app

  * `ui.R`
  * `server.R`

## The `ui.R` file

  * `ui.R`: user interface. Similar for most apps

```{r eval=TRUE, results="hide", cache=FALSE, message=FALSE}
library("shiny")
fluidPage(
  titlePanel("Shiny happy people"), #title
  ## Sidebar with a slider input for no. of points
  sidebarLayout( 
    sidebarPanel(
      sliderInput("n", "Number of points:", min = 1, 
                                  max = 50, value = 30)
    ),
    ## Show a plot of the generated distribution
    mainPanel(plotOutput("scatter"))
  )
)
```  

## Basic `ui.R` layout

```{r echo=FALSE, message=FALSE}
library(jrShiny)
layout(matrix(1:2, 1), width=c(1, 3))
layout_show(2, text=c("Side bar", "Chart"), cex=1.5)
text(0.1, 1, "Shiny Happy people")
```

## The `server.R` file

  * `server.R`: calculation logic
  * Complement to `ui.R`

## The `server.R` file

```{r eval = TRUE, results="hide", message=FALSE}
library("shiny")
# Function always has input & output
function(input, output) {
  # Expression that generates a plot. 
  # A call to renderPlot indicates that:
  #  1) It is "reactive" and therefore should 
  #   re-execute automatically when inputs change
  #  2) Its output type is a plot
  output$scatter = renderPlot({plot(rnorm(input$n))})
}
``` 
`output$scatter` links to the `plotOutput('scatter')`

# Chapter 5: Exercise 1
## Chapter 5: Exercise 1
```{r eval=FALSE}
vignette("chapter5", package="jrShiny")
```

# Running the app (page 20)
## Running the app

  * Typically we have `ui.R` and `server.R` in a single directory.
    * You can not have more than one app per directory.
  * To run the app, use `runApp` 
  * Assuming you have saved your files in a directory called `first_app`, then you can launch the app via

    ```{r eval=FALSE}
    library("shiny")
    runApp("my_app")
    ```

## Output objects (page 20)

  * The above app is very similar to the flexdashboard.
  * However there is one new addition, `Output`
  * In the above code, `plotOutput` takes the plot function and creates an image.
    * `tableOutput` displays a table.
    * `textOutput` outputs some text.

## Output objects

Output function | creates 
----------------|---------
`htmlOutput` | raw HTML
`imageOutput` | image
`plotOutput` | plot
`tableOutput` | table
`textOutput` | text
`uiOutput` | raw HTML
`verbatimTextOutput` | text


## Layout (page 20)

  * Shiny comes with tags.
    * The `em` tag is for italics
    ```{r results="hide"}
    em("Some text")
    ```
  * Most of the markdown tags we have encountered have a corresponding HTML tag.
  * See table in the notes for more details

## The `fluidPage` function

  * `fluidPage`  adjusts the display to the dimensions of the browser's window.
  * The easiest interface is to have is to have the sidebar layout -- a sidebar panel and a
  main panel:

```{r results="hide", cache=FALSE}
fluidPage(
  titlePanel("Title panel"),# Title
  ## Sidebar style
  sidebarLayout(
    sidebarPanel("The sidebar"),
    mainPanel("Main panel")
  )
)
``` 



## `sidebarLayout`: swap sides

```{r results="hide", cache=FALSE}
sidebarLayout(position="right",
  sidebarPanel("The sidebar"),
  mainPanel("Main panel")
)
```

## `sidebarLayout`

To add content, just place it inside the `Panel` function.
```{r results="hide"}
sidebarLayout(
  sidebarPanel("The sidebar", p("Choose an option")),
  mainPanel("Main panel")
)
```   

## `sidebarLayout`

  * `sidebarLayout` uses Shiny's lower-level grid layout functions.
    * Columns are defined by the `column`; rows by the `fluidRow` function.
  * A page contains $12$ columns.
    * Rows are created by the `fluidRow` function and include columns defined by the `column` function.
  * Column widths: Bootstrap $12$-wide grid system


## Layout

```{r results="hide", cache=TRUE}
ui = fluidPage(
  titlePanel("I love movies"), #Title
  fluidRow( # Define a row
    column(4, # Two columns: width 4 & 8
    wellPanel(
      selectInput("movie_type", label = "Movie genre", 
          c("Romance", "Action", "Animation"))
      )       
    ),
  column(8, plotOutput("scatter"))
  )
)
```

## Other layouts


* __Tab Sets__ Similar to the tabbed panel in `flexdashboard` - See [tabSetPanel](http://shiny.rstudio.com/articles/layout-guide.html)
* __Navbar Pages__ Similar to pages
* __Dashboards__ Similar to the `flexdashboard`, but more powerful.


# Interactive graphics with shiny
## Interactive graphics with shiny

Select points and regions as well as zooming in/out of images.

## Interactive graphics with shiny

As before, we create a `ui` component

```{r results="hide"}
library("shiny")
## Basic layout. Two regions.
ui = basicPage(
  plotOutput("scatter", click = "plot_click"),
  verbatimTextOutput("info")
)
```  
__Note__ `click`

## Interactive graphics with shiny

  
* `click` captures where we clickThis will capture where we click on
the plot.
* In `server.R` we get the  variable `input$plot_click` ,

## Interactive graphics with shiny
```{r cache=TRUE}
## Simulate data
x = signif(rnorm(10), 3); y = signif(rnorm(10), 3);
server = function(input, output) {
  output$scatter = renderPlot(plot(x, y))
  output$info = renderText({
    paste0("x=", input$plot_click$x, "\ny=", input$plot_click$y)
  })
}
```   

# Exercise 1: Chapter 5

# Deployment
## Deployment: No shiny

```{r echo=FALSE}
knitr::include_graphics("graphics/email.jpg")
```

## Deployment: Shiny
  
  * Set up your own shiny [server](https://www.rstudio.com/products/shiny/shiny-server/)
    * Open-source version and a paid version.
  * Host your app in the cloud with `shinyapps.io`
    * Free and paid [versions](http://shiny.rstudio.com/articles/shinyapps.html)
  
    ```{r eval=FALSE}
    library("rsconnect")
    deployApp("name_of_app.Rmd")
    ``` 


