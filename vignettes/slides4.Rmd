---
title: "Chapter 4"
author: Jumping Rivers
date: "`r Sys.Date()`"
#output: revealjs::revealjs_presentation
output: ioslides_presentation
css: left.css
---
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Chapter 4 Slides}
-->


# Parameterised reports

## Including parameters

  * R Markdown documents can optionally include one or more parameters. 
  * Parameters are useful when you want to re--render the same report with distinct values for various key inputs:
    * Running a report specific to a department or geographic region.
    * Running a report that covers a specific period of time.
    * Running mulitple versions of a report for distinct sets of core assumptions.

## Declare parameters in the YAML

__NOTE__: space before region
```
---
title: My Document
output: html_document
params:
	region: east
---
```

This tells us that we have a single parameter called region which takes a default value "east". 


## Add R commands

Arbitrary R objects can be used by specifying the value using an R expression.

```
---
title: My Document
output: html_document
params:
	start: !r as.Date("2015-01-01")
---
```
R expressions are prefaced with `!r`

__NOTE__: space before start

## Using Parameters

Declared parameters are available within the knitted environment as components of a list (`params`)

```
params$start
```

## Exercise 1 (chapter 4)


## Passing alternative parameter values

To vary the parameters in the document use the params argument of `rmarkdown::render()`

```{r eval = FALSE}
rmarkdown::render("MyDocument.Rmd", 
	params = list(
		region = "west",
		start = as.Date("1970-01-01")
	)
)
```

## Exercise 2 (chapter 4)

## User interface for parameters

If your document contains parameters and you specify `params = "ask"` argument in the call to `render` then a user interface is provided to specify parameter values. For example, consider:

```
---
title: "My Document"
output: html_document
params: 
	minimum: 100
	region: east
	data: results.csv
---
```

```{r eval = FALSE}
rmarkdown::render("MyDocument.Rmd", params = "ask")
```

you will get a basic user interface for parameter entry.

## User interface: shiny

  * We haven't really talked about `shiny`, 
  * but it is a R package that allows us to create interactivity with our graphics and documents. 
  * As a result however we can take advantage of standard `shiny} input controls. 
  * You can customise inputs by adding the appropriate values to the parameter YAML. 
  * For example we could customise the parameters in the previous example to use the `shiny` `sliderInput` `selectInput` and `fileInput` controls:


## Task Scheduling

  * It is also possible to schedule R scripts/processes with the Windows task scheduler. 
    * CRON jobs under linux/Max
  * This allows Windows users to automate R processes at specific timepoints from R itself using the R package `taskscheduleR`. 
  * This package is not currently available on CRAN, however can be installed directly from github if you have the `devtools` package.

```{r, eval=FALSE}
devtools::install_github("bnosac/taskscheduleR")
```

## Example usage: `taskscheduleR` 

  * Get the list of scheduled tasks.
  * Remove a task.
  * Add a task
    * A task is basically a script with R code which will be run using Rscript.
    * You can schedule tasks 'ONCE', 'MONTHLY' 'WEEKLY', 'DAILY', 'HOURLY', 'MINUTE', 'ONLOGON', 'ONIDLE'.
    * The task log contains the stdout and stderr (standard output and errors) which was run at that timepoint. This log can be found in the same folder as the R script.

## Example usage: `taskscheduleR` 

To create a new task we could use the following R code:

```{r eval = FALSE}
library(taskscheduleR)
myscript = "scripttorundaily.R"
taskscheduler_create(taskname = "namefortask", rscript = myscript,
                     schedule = "DAILY", starttime = "09:10", 
                     startdata = format(Sys.Date() + 1, "%d/%m/%Y")
```

Which would run `scripttorundaily.R` daily at 9:10 am starting tomorrow.

## Example usage: `taskscheduleR` 

```{r eval = FALSE, tidy=FALSE}
## Run every week on Sunday at 09:10
taskscheduler_create(taskname = "myfancyscript_sun", 
                     rscript = myscript, 
                     schedule = "WEEKLY", 
                     starttime = "09:10", 
                     days = 'SUN')

## Run every 5 minutes, starting from 10:40
taskscheduler_create(taskname = "myfancyscript_5min", 
                     rscript = myscript,
                     schedule = "MINUTE", 
                     starttime = "10:40", 
                     modifier = 5)
```

## Viewing and removing tasks

To view all currently scheduled tasks:

```{r eval = FALSE}
tasks = taskscheduler_ls()
str(tasks)
```

Or to delete tasks: 

```{r eval = FALSE}
taskscheduler_delete(taskname = "namefortask")
```

## Exercise 3 (chapter 4)
